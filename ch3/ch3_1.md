# CT重建

计算机断层成像（Computed Tomography, CT）技术通过多角度投影数据重建物体内部结构，是现代医学影像学和工业检测的核心方法。本文系统介绍CT重建的四个关键部分：投影几何、Radon 变换与滤波反投影、三维 FDK 算法、以及迭代重建与正则化技术。通过数学推导与Python实例演示，读者可深入理解从投影采集到断层图像重建的完整流程，并比较不同算法在噪声、采样不足与精度方面的表现。文中所有示例均基于Shepp–Logan phantom模型实现。

## 1. 投影几何（Fan/Cone-beam）

### 1.1 几何建模原理

在 CT 系统中，X 射线源绕被扫描物体旋转，从不同角度发射射线并由探测器阵列接收透射信号，最基础的二维模型为平行束几何（Parallel-beam geometry），设物体的衰减系数分布为 ( f(x, y) )，对于方向角 ( \theta ) 的平行射线，投影为：

$$
p(s, \theta) = \int_{-\infty}^{+\infty} f(x, y) , \delta(s - x\cos\theta - y\sin\theta) , dxdy
$$

该积分即为 **Radon 变换**。



### 1.2 扇束（Fan-beam）几何

在实际的 CT 扫描仪中，X 射线从焦点发散，形成扇形束照射到线性探测器上。
如图所示（示意）：

```
       Detector array
    ---------------------
       \   |   |   /
        \  |   |  /
         \ |   | /
          \|   |/
           *  (source)
```

设源点与旋转中心距离为  $D_s$ ，探测器与中心距离为  $D_d$ ，探测器上坐标为  $\gamma$ ，则投影角度关系为：

$$
p(\beta, \gamma) = \int f(x, y) , \delta(x\cos(\beta + \gamma) + y\sin(\beta + \gamma) - D_s \sin\gamma) , dxdy
$$

其中：

* ( $\beta$ )：旋转角度；
* ( $\gamma$ )：扇形射线角度。



### 1.3 锥束（Cone-beam）几何

三维 CT 系统中，源点为点源，探测器为平面阵列，射线发散成锥形。
设射线方向由角度 ((\theta, \phi)) 表示，则投影可写为

$$
P(u, v, \theta) = \int f(x, y, z) , \delta(u - u(x,y,z,\theta)) , \delta(v - v(x,y,z,\theta)) , dxdydz
$$



### 1.4 Python 示例：扇束投影模拟

```python
import numpy as np
import matplotlib.pyplot as plt
from skimage.data import shepp_logan_phantom
from skimage.transform import radon

# 生成 Shepp–Logan phantom
image = shepp_logan_phantom()
theta = np.linspace(0., 180., max(image.shape), endpoint=False)

# 计算平行束投影 (Radon)
sinogram = radon(image, theta=theta)

plt.figure(figsize=(8, 4))
plt.subplot(1, 2, 1)
plt.title("Shepp–Logan Phantom")
plt.imshow(image, cmap='gray')

plt.subplot(1, 2, 2)
plt.title("Sinogram (Radon Transform)")
plt.imshow(sinogram, cmap='gray', aspect='auto')
plt.xlabel("Projection angle (deg)")
plt.ylabel("Detector position")
plt.tight_layout()
plt.show()
```

此代码展示了从物体到正弦图（Sinogram）的转换过程，反映不同角度下的投影几何特征。



## 2. Radon 变换与滤波反投影（FBP）

### 2.1 Radon 变换回顾

Radon 变换的数学表达为：

$$
R{f(x, y)}(\rho, \theta) = \int_{-\infty}^{+\infty} \int_{-\infty}^{+\infty} f(x, y) , \delta(\rho - x\cos\theta - y\sin\theta) , dxdy
$$

该变换描述了每条射线穿过物体时的线积分。


### 2.2 中心切片定理（Central Slice Theorem）

CT 重建的核心在于中心切片定理：

$$
\mathcal{F}*{1D}{p(\rho, \theta)}(\omega) = \mathcal{F}*{2D}{f(x, y)}(\omega \cos\theta, \omega \sin\theta)
$$

该定理说明：投影的一维傅里叶变换等价于原图二维傅里叶域的径向切片。



### 2.3 滤波反投影（Filtered Back Projection, FBP）

滤波反投影通过以下步骤实现图像重建：

1. 对每个角度的投影进行傅里叶变换；
2. 乘以滤波器  $|\omega|$ （Ram-Lak 滤波）；
3. 逆变换回空间域；
4. 将所有角度的滤波投影按角度反投影求和。

数学表达为：

$$
f(x, y) = \int_0^{\pi} \int_{-\infty}^{+\infty} |\omega| , P(\omega, \theta) , e^{j2\pi \omega (x\cos\theta + y\sin\theta)} , d\omega d\theta
$$



### 2.4 Python 实战：FBP 重建

```python
from skimage.transform import iradon

# 反投影重建
reconstruction_fbp = iradon(sinogram, theta=theta, filter_name='ramp')

plt.figure(figsize=(10, 4))
plt.subplot(1, 2, 1)
plt.title("Sinogram")
plt.imshow(sinogram, cmap='gray', aspect='auto')

plt.subplot(1, 2, 2)
plt.title("FBP Reconstruction")
plt.imshow(reconstruction_fbp, cmap='gray')
plt.tight_layout()
plt.show()
```

结果分析：FBP 重建速度快、结构清晰，但对噪声敏感。滤波器选择（Ram-Lak、Shepp–Logan、Cosine）会影响重建分辨率与平滑度。



## 3. FDK 算法（3D 锥束重建）

### 3.1 原理背景

FDK（Feldkamp-Davis-Kress）算法是针对圆轨迹锥束几何的近似重建方法，是目前医学CT的标准算法。

设源点绕z轴旋转角度  $\beta$ ，探测器坐标为  $(u,v)$  ，系统几何参数：

*  $D_s$ ：源到旋转中心距离；
*  $D_d$ ：源到探测器距离；
*  $f(x, y, z)$ ：体积衰减函数。



### 3.2 数学推导
1. 加权校正：

$$
W(\beta, u, v) = \frac{D_s^2}{(D_s^2 + u^2 + v^2)^{3/2}}
$$

2. 滤波步骤：

对每个投影行进行一维卷积滤波：

$$
P'(\beta, u, v) = (P * h)(u)
$$

其中 $h(u)$  为Ram-Lak或Shepp–Logan滤波器。

3. 反投影步骤：

$$
f(x, y, z) = \int P'(\beta, u(x,y,z,\beta), v(x,y,z,\beta)) , d\beta
$$





### 3.3 Python 示例（ASTRA Toolbox）

```python
import astra
import numpy as np

# 生成体模 (phantom)
vol_geom = astra.creators.create_vol_geom(128, 128, 128)
proj_geom = astra.creators.create_proj_geom('cone', 1.0, 1.0, 128, 128, np.linspace(0, np.pi, 180))

phantom = np.ones((128, 128, 128), dtype=np.float32)

# 投影
proj_id, sinogram = astra.creators.create_sino3d_gpu(phantom, proj_geom, vol_geom)

# FDK 重建
rec_id = astra.data3d.create('-vol', vol_geom)
cfg = astra.astra_dict('FDK_CUDA')
cfg['ProjectionDataId'] = proj_id
cfg['ReconstructionDataId'] = rec_id
alg_id = astra.algorithm.create(cfg)
astra.algorithm.run(alg_id)

reconstruction = astra.data3d.get(rec_id)
astra.algorithm.delete(alg_id)
```

该示例展示了使用 GPU 加速的 FDK 重建流程，可用于 3D 医学 CT 数据集。



## 4. 迭代重建与正则化（SART, OSEM, TV, Tikhonov）

### 4.1 迭代重建的基本思想

迭代重建（Iterative Reconstruction）将重建问题建模为线性方程：

$$
A f = g
$$

其中：

*  $f$ ：待求图像；
*  $g$ ：测得的投影数据；
*  $A$ ：系统矩阵（描述射线穿过每个像素的长度）。

直接求解往往不稳定，需通过迭代优化最小化：

$$
\min_f | A f - g |_2^2 + \lambda R(f)
$$



### 4.2 SART（Simultaneous Algebraic Reconstruction Technique）

SART 算法更新公式为：

$$
f_j^{(k+1)} = f_j^{(k)} + \frac{1}{\sum_i a_{ij}} \sum_i \frac{a_{ij}}{\sum_j a_{ij}} \left( g_i - \sum_j a_{ij} f_j^{(k)} \right)
$$

SART在每次迭代中利用一个或多个角度的投影更新结果，收敛速度快于ART。

### 4.3 OSEM（Ordered Subsets Expectation Maximization）

OSEM 是在 Poisson 噪声假设下的最大似然方法，将投影划分为若干子集并交替更新：

$$
f^{(k+1)} = f^{(k)} \frac{A^T \left( \frac{g}{A f^{(k)}} \right)}{A^T \mathbf{1}}
$$

可显著加快收敛速度，常用于PET/CT重建。

### 4.4 正则化方法

#### (1) Tikhonov 正则化（L2）

$$
R(f) = |Lf|_2^2
$$

平滑图像，抑制噪声。

#### (2) 总变分（Total Variation, TV）

$$
R(f) = \int |\nabla f| , dxdy
$$

保持边缘清晰的同时去除噪声。



### 4.5 Python 实战：SART 重建与 TV 正则化

```python
import astra

# 创建几何配置
vol_geom = astra.creators.create_vol_geom(256, 256)
proj_geom = astra.creators.create_proj_geom('parallel', 1.0, 384, np.linspace(0, np.pi, 180))

# Phantom 与投影
phantom = shepp_logan_phantom().astype(np.float32)
proj_id, sinogram = astra.create_sino(phantom, proj_geom)

# SART 算法配置
recon_id = astra.data2d.create('-vol', vol_geom)
cfg = astra.astra_dict('SART_CUDA')
cfg['ProjectionDataId'] = proj_id
cfg['ReconstructionDataId'] = recon_id

alg_id = astra.algorithm.create(cfg)
astra.algorithm.run(alg_id, 20)  # 迭代次数

reconstruction_sart = astra.data2d.get(recon_id)
plt.imshow(reconstruction_sart, cmap='gray')
plt.title("SART Reconstruction")
plt.show()
```

TV 正则化通常通过变分求解或结合 SART/OSEM 在每步迭代后进行平滑约束。


### 4.6 算法性能对比

| 算法    | 优点      | 缺点   | 典型应用    |
| ----- | ------- | ---- | ------- |
| FBP   | 快速、解析解  | 噪声敏感 | 临床常规 CT |
| FDK   | 支持锥束、三维 | 近似误差 | 螺旋 CT   |
| SART  | 收敛快、抗噪强 | 计算量大 | 低剂量 CT  |
| OSEM  | 统计建模、鲁棒 | 实现复杂 | PET/CT  |
| TV 正则 | 保边去噪    | 参数敏感 | 稀疏采样重建  |



## 结语
本文从投影几何出发，系统介绍了Radon变换、滤波反投影、FDK与迭代重建方法。在现代 CT 系统中，FDK是主流三维算法，而结合SART/OSEM + TV 正则化的迭代重建成为低剂量与稀疏采样场景的重要方向，结合GPU加速与深度学习辅助，CT重建正在迈向高分辨率与低辐射并存的新阶段。


## 5. 参考文献

1. Radon, J. “Über die Bestimmung von Funktionen durch ihre Integralwerte längs gewisser Mannigfaltigkeiten.” *Berichte über die Verhandlungen der Königlich-Sächsischen Gesellschaft der Wissenschaften zu Leipzig*, 1917.
2. Kak, A. C., & Slaney, M. *Principles of Computerized Tomographic Imaging*, IEEE Press, 1988.
3. Feldkamp, L. A., Davis, L. C., & Kress, J. W. “Practical cone-beam algorithm.” *JOSA A*, 1984.
4. Andersen, A. H., & Kak, A. C. “Simultaneous algebraic reconstruction technique (SART): a superior implementation of the ART algorithm.” *Ultrasonic Imaging*, 1984.
5. Hudson, H. M., & Larkin, R. S. “Accelerated image reconstruction using ordered subsets of projection data.” *IEEE TMI*, 1994.
6. Chambolle, A., & Pock, T. “An introduction to continuous optimization for imaging.” *Acta Numerica*, 2016.
7. Hansen, P. C. *Discrete Inverse Problems: Insight and Algorithms.* SIAM, 2010.
8. Buzug, T. M. *Computed Tomography: From Photon Statistics to Modern Cone-Beam CT.* Springer, 2008.
9. Xu, F., Mueller, K. “Real-time 3D computed tomographic reconstruction using commodity graphics hardware.” *Physics in Medicine & Biology*, 2007.




