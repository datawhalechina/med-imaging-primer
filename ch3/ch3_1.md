# ğŸ©º CT é‡å»ºåŸç†ä¸å®ç°æŠ¥å‘Š

è®¡ç®—æœºæ–­å±‚æˆåƒï¼ˆComputed Tomography, CTï¼‰æŠ€æœ¯é€šè¿‡å¤šè§’åº¦æŠ•å½±æ•°æ®é‡å»ºç‰©ä½“å†…éƒ¨ç»“æ„ï¼Œæ˜¯ç°ä»£åŒ»å­¦å½±åƒå­¦å’Œå·¥ä¸šæ£€æµ‹çš„æ ¸å¿ƒæ–¹æ³•ã€‚æœ¬æ–‡ç³»ç»Ÿä»‹ç»CTé‡å»ºçš„å››ä¸ªå…³é”®éƒ¨åˆ†ï¼šæŠ•å½±å‡ ä½•ã€Radon å˜æ¢ä¸æ»¤æ³¢åæŠ•å½±ã€ä¸‰ç»´ FDK ç®—æ³•ã€ä»¥åŠè¿­ä»£é‡å»ºä¸æ­£åˆ™åŒ–æŠ€æœ¯ã€‚é€šè¿‡æ•°å­¦æ¨å¯¼ä¸Pythonå®ä¾‹æ¼”ç¤ºï¼Œè¯»è€…å¯æ·±å…¥ç†è§£ä»æŠ•å½±é‡‡é›†åˆ°æ–­å±‚å›¾åƒé‡å»ºçš„å®Œæ•´æµç¨‹ï¼Œå¹¶æ¯”è¾ƒä¸åŒç®—æ³•åœ¨å™ªå£°ã€é‡‡æ ·ä¸è¶³ä¸ç²¾åº¦æ–¹é¢çš„è¡¨ç°ã€‚æ–‡ä¸­æ‰€æœ‰ç¤ºä¾‹å‡åŸºäºSheppâ€“Logan phantomæ¨¡å‹å®ç°ã€‚

## 1. æŠ•å½±å‡ ä½•ï¼ˆFan/Cone-beamï¼‰

### 1.1 å‡ ä½•å»ºæ¨¡åŸç†

åœ¨ CT ç³»ç»Ÿä¸­ï¼ŒX å°„çº¿æºç»•è¢«æ‰«æç‰©ä½“æ—‹è½¬ï¼Œä»ä¸åŒè§’åº¦å‘å°„å°„çº¿å¹¶ç”±æ¢æµ‹å™¨é˜µåˆ—æ¥æ”¶é€å°„ä¿¡å·ã€‚
æœ€åŸºç¡€çš„äºŒç»´æ¨¡å‹ä¸º **å¹³è¡ŒæŸå‡ ä½•ï¼ˆParallel-beam geometryï¼‰**ã€‚è®¾ç‰©ä½“çš„è¡°å‡ç³»æ•°åˆ†å¸ƒä¸º ( f(x, y) )ï¼Œå¯¹äºæ–¹å‘è§’ ( \theta ) çš„å¹³è¡Œå°„çº¿ï¼ŒæŠ•å½±ä¸ºï¼š

$$
p(s, \theta) = \int_{-\infty}^{+\infty} f(x, y) , \delta(s - x\cos\theta - y\sin\theta) , dxdy
$$

è¯¥ç§¯åˆ†å³ä¸º **Radon å˜æ¢**ã€‚



### 1.2 æ‰‡æŸï¼ˆFan-beamï¼‰å‡ ä½•

åœ¨å®é™…çš„ CT æ‰«æä»ªä¸­ï¼ŒX å°„çº¿ä»ç„¦ç‚¹å‘æ•£ï¼Œå½¢æˆæ‰‡å½¢æŸç…§å°„åˆ°çº¿æ€§æ¢æµ‹å™¨ä¸Šã€‚
å¦‚å›¾æ‰€ç¤ºï¼ˆç¤ºæ„ï¼‰ï¼š

```
       Detector array
    ---------------------
       \   |   |   /
        \  |   |  /
         \ |   | /
          \|   |/
           *  (source)
```

è®¾æºç‚¹ä¸æ—‹è½¬ä¸­å¿ƒè·ç¦»ä¸º  $D_s$ ï¼Œæ¢æµ‹å™¨ä¸ä¸­å¿ƒè·ç¦»ä¸º  $D_d$ ï¼Œæ¢æµ‹å™¨ä¸Šåæ ‡ä¸º  $\gamma$ ï¼Œåˆ™æŠ•å½±è§’åº¦å…³ç³»ä¸ºï¼š

$$
p(\beta, \gamma) = \int f(x, y) , \delta(x\cos(\beta + \gamma) + y\sin(\beta + \gamma) - D_s \sin\gamma) , dxdy
$$

å…¶ä¸­ï¼š

* ( $\beta$ )ï¼šæ—‹è½¬è§’åº¦ï¼›
* ( $\gamma$ )ï¼šæ‰‡å½¢å°„çº¿è§’åº¦ã€‚



### 1.3 é”¥æŸï¼ˆCone-beamï¼‰å‡ ä½•

ä¸‰ç»´ CT ç³»ç»Ÿä¸­ï¼Œæºç‚¹ä¸ºç‚¹æºï¼Œæ¢æµ‹å™¨ä¸ºå¹³é¢é˜µåˆ—ï¼Œå°„çº¿å‘æ•£æˆé”¥å½¢ã€‚
è®¾å°„çº¿æ–¹å‘ç”±è§’åº¦ ((\theta, \phi)) è¡¨ç¤ºï¼Œåˆ™æŠ•å½±å¯å†™ä¸ºï¼š

$$
P(u, v, \theta) = \int f(x, y, z) , \delta(u - u(x,y,z,\theta)) , \delta(v - v(x,y,z,\theta)) , dxdydz
$$



### 1.4 Python ç¤ºä¾‹ï¼šæ‰‡æŸæŠ•å½±æ¨¡æ‹Ÿ

```python
import numpy as np
import matplotlib.pyplot as plt
from skimage.data import shepp_logan_phantom
from skimage.transform import radon

# ç”Ÿæˆ Sheppâ€“Logan phantom
image = shepp_logan_phantom()
theta = np.linspace(0., 180., max(image.shape), endpoint=False)

# è®¡ç®—å¹³è¡ŒæŸæŠ•å½± (Radon)
sinogram = radon(image, theta=theta)

plt.figure(figsize=(8, 4))
plt.subplot(1, 2, 1)
plt.title("Sheppâ€“Logan Phantom")
plt.imshow(image, cmap='gray')

plt.subplot(1, 2, 2)
plt.title("Sinogram (Radon Transform)")
plt.imshow(sinogram, cmap='gray', aspect='auto')
plt.xlabel("Projection angle (deg)")
plt.ylabel("Detector position")
plt.tight_layout()
plt.show()
```

æ­¤ä»£ç å±•ç¤ºäº†ä»ç‰©ä½“åˆ°æ­£å¼¦å›¾ï¼ˆSinogramï¼‰çš„è½¬æ¢è¿‡ç¨‹ï¼Œåæ˜ ä¸åŒè§’åº¦ä¸‹çš„æŠ•å½±å‡ ä½•ç‰¹å¾ã€‚



## 2. Radon å˜æ¢ä¸æ»¤æ³¢åæŠ•å½±ï¼ˆFBPï¼‰

### 2.1 Radon å˜æ¢å›é¡¾

Radon å˜æ¢çš„æ•°å­¦è¡¨è¾¾ä¸ºï¼š

$$
R{f(x, y)}(\rho, \theta) = \int_{-\infty}^{+\infty} \int_{-\infty}^{+\infty} f(x, y) , \delta(\rho - x\cos\theta - y\sin\theta) , dxdy
$$

è¯¥å˜æ¢æè¿°äº†æ¯æ¡å°„çº¿ç©¿è¿‡ç‰©ä½“æ—¶çš„çº¿ç§¯åˆ†ã€‚


### 2.2 ä¸­å¿ƒåˆ‡ç‰‡å®šç†ï¼ˆCentral Slice Theoremï¼‰

CT é‡å»ºçš„æ ¸å¿ƒåœ¨äº **ä¸­å¿ƒåˆ‡ç‰‡å®šç†**ï¼š

$$
\mathcal{F}*{1D}{p(\rho, \theta)}(\omega) = \mathcal{F}*{2D}{f(x, y)}(\omega \cos\theta, \omega \sin\theta)
$$

è¯¥å®šç†è¯´æ˜ï¼šæŠ•å½±çš„ä¸€ç»´å‚…é‡Œå¶å˜æ¢ç­‰ä»·äºåŸå›¾äºŒç»´å‚…é‡Œå¶åŸŸçš„å¾„å‘åˆ‡ç‰‡ã€‚



### 2.3 æ»¤æ³¢åæŠ•å½±ï¼ˆFiltered Back Projection, FBPï¼‰

æ»¤æ³¢åæŠ•å½±é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°å›¾åƒé‡å»ºï¼š

1. å¯¹æ¯ä¸ªè§’åº¦çš„æŠ•å½±è¿›è¡Œå‚…é‡Œå¶å˜æ¢ï¼›
2. ä¹˜ä»¥æ»¤æ³¢å™¨ ( $|\omega|$ )ï¼ˆRam-Lak æ»¤æ³¢ï¼‰ï¼›
3. é€†å˜æ¢å›ç©ºé—´åŸŸï¼›
4. å°†æ‰€æœ‰è§’åº¦çš„æ»¤æ³¢æŠ•å½±æŒ‰è§’åº¦åæŠ•å½±æ±‚å’Œã€‚

æ•°å­¦è¡¨è¾¾ä¸ºï¼š

$$
f(x, y) = \int_0^{\pi} \int_{-\infty}^{+\infty} |\omega| , P(\omega, \theta) , e^{j2\pi \omega (x\cos\theta + y\sin\theta)} , d\omega d\theta
$$



### 2.4 Python å®æˆ˜ï¼šFBP é‡å»º

```python
from skimage.transform import iradon

# åæŠ•å½±é‡å»º
reconstruction_fbp = iradon(sinogram, theta=theta, filter_name='ramp')

plt.figure(figsize=(10, 4))
plt.subplot(1, 2, 1)
plt.title("Sinogram")
plt.imshow(sinogram, cmap='gray', aspect='auto')

plt.subplot(1, 2, 2)
plt.title("FBP Reconstruction")
plt.imshow(reconstruction_fbp, cmap='gray')
plt.tight_layout()
plt.show()
```

**ç»“æœåˆ†æ**ï¼š
FBP é‡å»ºé€Ÿåº¦å¿«ã€ç»“æ„æ¸…æ™°ï¼Œä½†å¯¹å™ªå£°æ•æ„Ÿã€‚æ»¤æ³¢å™¨é€‰æ‹©ï¼ˆRam-Lakã€Sheppâ€“Loganã€Cosineï¼‰ä¼šå½±å“é‡å»ºåˆ†è¾¨ç‡ä¸å¹³æ»‘åº¦ã€‚



## 3. FDK ç®—æ³•ï¼ˆ3D é”¥æŸé‡å»ºï¼‰

### 3.1 åŸç†èƒŒæ™¯

FDKï¼ˆFeldkamp-Davis-Kressï¼‰ç®—æ³•æ˜¯é’ˆå¯¹åœ†è½¨è¿¹é”¥æŸå‡ ä½•çš„è¿‘ä¼¼é‡å»ºæ–¹æ³•ï¼Œæ˜¯ç›®å‰åŒ»å­¦CTçš„æ ‡å‡†ç®—æ³•ã€‚

è®¾æºç‚¹ç»• z è½´æ—‹è½¬è§’åº¦  $\beta$ ï¼Œæ¢æµ‹å™¨åæ ‡ä¸º  $(u,v)$  ï¼Œç³»ç»Ÿå‡ ä½•å‚æ•°ï¼š

*  $D_s$ ï¼šæºåˆ°æ—‹è½¬ä¸­å¿ƒè·ç¦»ï¼›
*  $D_d$ ï¼šæºåˆ°æ¢æµ‹å™¨è·ç¦»ï¼›
*  $f(x, y, z)$ ï¼šä½“ç§¯è¡°å‡å‡½æ•°ã€‚



### 3.2 æ•°å­¦æ¨å¯¼

FDK ç®—æ³•ä¸»è¦æ­¥éª¤ï¼š

1. åŠ æƒæ ¡æ­£ï¼š
   
   $$
   W(\beta, u, v) = \frac{D_s^2}{(D_s^2 + u^2 + v^2)^{3/2}}
   $$

2. æ»¤æ³¢æ­¥éª¤ï¼š
   å¯¹æ¯ä¸ªæŠ•å½±è¡Œè¿›è¡Œä¸€ç»´å·ç§¯æ»¤æ³¢ï¼š
   
   $$
   P'(\beta, u, v) = (P * h)(u)
   $$

   å…¶ä¸­ ( h(u) ) ä¸º Ram-Lak æˆ– Sheppâ€“Logan æ»¤æ³¢å™¨ã€‚

3. åæŠ•å½±æ­¥éª¤ï¼š
   
   $$
   f(x, y, z) = \int P'(\beta, u(x,y,z,\beta), v(x,y,z,\beta)) , d\beta
   $$

---

### 3.3 Python ç¤ºä¾‹ï¼ˆASTRA Toolboxï¼‰

```python
import astra
import numpy as np

# ç”Ÿæˆä½“æ¨¡ (phantom)
vol_geom = astra.creators.create_vol_geom(128, 128, 128)
proj_geom = astra.creators.create_proj_geom('cone', 1.0, 1.0, 128, 128, np.linspace(0, np.pi, 180))

phantom = np.ones((128, 128, 128), dtype=np.float32)

# æŠ•å½±
proj_id, sinogram = astra.creators.create_sino3d_gpu(phantom, proj_geom, vol_geom)

# FDK é‡å»º
rec_id = astra.data3d.create('-vol', vol_geom)
cfg = astra.astra_dict('FDK_CUDA')
cfg['ProjectionDataId'] = proj_id
cfg['ReconstructionDataId'] = rec_id
alg_id = astra.algorithm.create(cfg)
astra.algorithm.run(alg_id)

reconstruction = astra.data3d.get(rec_id)
astra.algorithm.delete(alg_id)
```

è¯¥ç¤ºä¾‹å±•ç¤ºäº†ä½¿ç”¨ GPU åŠ é€Ÿçš„ FDK é‡å»ºæµç¨‹ï¼Œå¯ç”¨äº 3D åŒ»å­¦ CT æ•°æ®é›†ã€‚



## 4. è¿­ä»£é‡å»ºä¸æ­£åˆ™åŒ–ï¼ˆSART, OSEM, TV, Tikhonovï¼‰

### 4.1 è¿­ä»£é‡å»ºçš„åŸºæœ¬æ€æƒ³

è¿­ä»£é‡å»ºï¼ˆIterative Reconstructionï¼‰å°†é‡å»ºé—®é¢˜å»ºæ¨¡ä¸ºçº¿æ€§æ–¹ç¨‹ï¼š

$$
A f = g
$$

å…¶ä¸­ï¼š

*  $f$ ï¼šå¾…æ±‚å›¾åƒï¼›
*  $g$ ï¼šæµ‹å¾—çš„æŠ•å½±æ•°æ®ï¼›
*  $A$ ï¼šç³»ç»ŸçŸ©é˜µï¼ˆæè¿°å°„çº¿ç©¿è¿‡æ¯ä¸ªåƒç´ çš„é•¿åº¦ï¼‰ã€‚

ç›´æ¥æ±‚è§£å¾€å¾€ä¸ç¨³å®šï¼Œéœ€é€šè¿‡è¿­ä»£ä¼˜åŒ–æœ€å°åŒ–ï¼š

$$
\min_f | A f - g |_2^2 + \lambda R(f)
$$



### 4.2 SARTï¼ˆSimultaneous Algebraic Reconstruction Techniqueï¼‰

SART ç®—æ³•æ›´æ–°å…¬å¼ä¸ºï¼š

$$
f_j^{(k+1)} = f_j^{(k)} + \frac{1}{\sum_i a_{ij}} \sum_i \frac{a_{ij}}{\sum_j a_{ij}} \left( g_i - \sum_j a_{ij} f_j^{(k)} \right)
$$

SARTåœ¨æ¯æ¬¡è¿­ä»£ä¸­åˆ©ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªè§’åº¦çš„æŠ•å½±æ›´æ–°ç»“æœï¼Œæ”¶æ•›é€Ÿåº¦å¿«äºARTã€‚

---

### 4.3 OSEMï¼ˆOrdered Subsets Expectation Maximizationï¼‰

OSEM æ˜¯åœ¨ Poisson å™ªå£°å‡è®¾ä¸‹çš„æœ€å¤§ä¼¼ç„¶æ–¹æ³•ï¼Œå°†æŠ•å½±åˆ’åˆ†ä¸ºè‹¥å¹²å­é›†å¹¶äº¤æ›¿æ›´æ–°ï¼š

$$
f^{(k+1)} = f^{(k)} \frac{A^T \left( \frac{g}{A f^{(k)}} \right)}{A^T \mathbf{1}}
$$

å¯æ˜¾è‘—åŠ å¿«æ”¶æ•›é€Ÿåº¦ï¼Œå¸¸ç”¨äºPET/CTé‡å»ºã€‚

### 4.4 æ­£åˆ™åŒ–æ–¹æ³•

#### (1) Tikhonov æ­£åˆ™åŒ–ï¼ˆL2ï¼‰

$$
R(f) = |Lf|_2^2
$$

å¹³æ»‘å›¾åƒï¼ŒæŠ‘åˆ¶å™ªå£°ã€‚

#### (2) æ€»å˜åˆ†ï¼ˆTotal Variation, TVï¼‰

$$
R(f) = \int |\nabla f| , dxdy
$$

ä¿æŒè¾¹ç¼˜æ¸…æ™°çš„åŒæ—¶å»é™¤å™ªå£°ã€‚



### 4.5 Python å®æˆ˜ï¼šSART é‡å»ºä¸ TV æ­£åˆ™åŒ–

```python
import astra

# åˆ›å»ºå‡ ä½•é…ç½®
vol_geom = astra.creators.create_vol_geom(256, 256)
proj_geom = astra.creators.create_proj_geom('parallel', 1.0, 384, np.linspace(0, np.pi, 180))

# Phantom ä¸æŠ•å½±
phantom = shepp_logan_phantom().astype(np.float32)
proj_id, sinogram = astra.create_sino(phantom, proj_geom)

# SART ç®—æ³•é…ç½®
recon_id = astra.data2d.create('-vol', vol_geom)
cfg = astra.astra_dict('SART_CUDA')
cfg['ProjectionDataId'] = proj_id
cfg['ReconstructionDataId'] = recon_id

alg_id = astra.algorithm.create(cfg)
astra.algorithm.run(alg_id, 20)  # è¿­ä»£æ¬¡æ•°

reconstruction_sart = astra.data2d.get(recon_id)
plt.imshow(reconstruction_sart, cmap='gray')
plt.title("SART Reconstruction")
plt.show()
```

TV æ­£åˆ™åŒ–é€šå¸¸é€šè¿‡å˜åˆ†æ±‚è§£æˆ–ç»“åˆ SART/OSEM åœ¨æ¯æ­¥è¿­ä»£åè¿›è¡Œå¹³æ»‘çº¦æŸã€‚


### 4.6 ç®—æ³•æ€§èƒ½å¯¹æ¯”

| ç®—æ³•    | ä¼˜ç‚¹      | ç¼ºç‚¹   | å…¸å‹åº”ç”¨    |
| ----- | ------- | ---- | ------- |
| FBP   | å¿«é€Ÿã€è§£æè§£  | å™ªå£°æ•æ„Ÿ | ä¸´åºŠå¸¸è§„ CT |
| FDK   | æ”¯æŒé”¥æŸã€ä¸‰ç»´ | è¿‘ä¼¼è¯¯å·® | èºæ—‹ CT   |
| SART  | æ”¶æ•›å¿«ã€æŠ—å™ªå¼º | è®¡ç®—é‡å¤§ | ä½å‰‚é‡ CT  |
| OSEM  | ç»Ÿè®¡å»ºæ¨¡ã€é²æ£’ | å®ç°å¤æ‚ | PET/CT  |
| TV æ­£åˆ™ | ä¿è¾¹å»å™ª    | å‚æ•°æ•æ„Ÿ | ç¨€ç–é‡‡æ ·é‡å»º  |



## ç»“è¯­
æœ¬æ–‡ä»æŠ•å½±å‡ ä½•å‡ºå‘ï¼Œç³»ç»Ÿä»‹ç»äº†Radonå˜æ¢ã€æ»¤æ³¢åæŠ•å½±ã€FDKä¸è¿­ä»£é‡å»ºæ–¹æ³•ã€‚åœ¨ç°ä»£ CT ç³»ç»Ÿä¸­ï¼ŒFDKæ˜¯ä¸»æµä¸‰ç»´ç®—æ³•ï¼Œè€Œç»“åˆSART/OSEM + TV æ­£åˆ™åŒ–çš„è¿­ä»£é‡å»ºæˆä¸ºä½å‰‚é‡ä¸ç¨€ç–é‡‡æ ·åœºæ™¯çš„é‡è¦æ–¹å‘ï¼Œç»“åˆGPUåŠ é€Ÿä¸æ·±åº¦å­¦ä¹ è¾…åŠ©ï¼ŒCTé‡å»ºæ­£åœ¨è¿ˆå‘é«˜åˆ†è¾¨ç‡ä¸ä½è¾å°„å¹¶å­˜çš„æ–°é˜¶æ®µã€‚


## 5. å‚è€ƒæ–‡çŒ®

1. Radon, J. â€œÃœber die Bestimmung von Funktionen durch ihre Integralwerte lÃ¤ngs gewisser Mannigfaltigkeiten.â€ *Berichte Ã¼ber die Verhandlungen der KÃ¶niglich-SÃ¤chsischen Gesellschaft der Wissenschaften zu Leipzig*, 1917.
2. Kak, A. C., & Slaney, M. *Principles of Computerized Tomographic Imaging*, IEEE Press, 1988.
3. Feldkamp, L. A., Davis, L. C., & Kress, J. W. â€œPractical cone-beam algorithm.â€ *JOSA A*, 1984.
4. Andersen, A. H., & Kak, A. C. â€œSimultaneous algebraic reconstruction technique (SART): a superior implementation of the ART algorithm.â€ *Ultrasonic Imaging*, 1984.
5. Hudson, H. M., & Larkin, R. S. â€œAccelerated image reconstruction using ordered subsets of projection data.â€ *IEEE TMI*, 1994.
6. Chambolle, A., & Pock, T. â€œAn introduction to continuous optimization for imaging.â€ *Acta Numerica*, 2016.
7. Hansen, P. C. *Discrete Inverse Problems: Insight and Algorithms.* SIAM, 2010.
8. Buzug, T. M. *Computed Tomography: From Photon Statistics to Modern Cone-Beam CT.* Springer, 2008.
9. Xu, F., Mueller, K. â€œReal-time 3D computed tomographic reconstruction using commodity graphics hardware.â€ *Physics in Medicine & Biology*, 2007.




